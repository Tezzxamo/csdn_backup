# 概要

redis与MySQL的数据同步，性能和一致性无法做到两全其美。

主要有以下几种方案：

- 业务层硬编码（主动同步）
- binlog增量同步

# 一、业务层硬编码实现数据同步：

在业务层通过代码实现数据同步。

## 1、先更新MySQL、再更新(删除)redis：

- 若redis更新(删除)失败，后续请求获取到旧数据的数据一致性问题。

## 2、先更新(删除)redis，再更新MySQL：

- 存在redis更新成功，但是MySQL更新失败的数据一致性问题。
- 存在redis缓存删除后，在更新数据库前有新线程读取数据，将数据存入缓存，导致数据不一致。

## 3、延时双删（最终一致性）：

- 先删缓存 → 写入MySQL → 延迟时间(直接sleep()；使用MQ消息消费；AOP+新线程) → 再次删除缓存(
      使新请求访问数据库后更新缓存)
- 延迟时间：延迟时间要＞数据库操作时间。
- 异步重试：删除失败的KEY加入MQ队列中重试。

## 4、增加互斥锁（分布式锁）（强一致性）：

- 线程A获取锁，更新MySQL后删除缓存，其他线程等待锁释放，避免并发更新导致的数据冲突。

# 二、binlog增量同步：

- 借用canal框架订阅binlog，实现增量同步。


